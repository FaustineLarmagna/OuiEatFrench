<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
Filtres pour les agriculteurs: <br><br>

<form>
    Sous catégorie !<br>
    <select id="product">
        <option value="%">Tous</option>
        {% for product in productAndParentProduct %}
            <option value="{{ product.id }}">{{ product.name|capitalize }}</option>
        {% endfor %}
    </select><br>
    Code postal de la compagnie<br>
    <input type="text" id="companyPostCode" ><br>
    Prix max au kilo<br>
    <input type="text" id="kilos" ><br>
    Prix max a l'unitée<br>
    <input type="text" id="unitee" ><br>
</form>

Liste des agriculteurs correspondant a votre produit : <br><br>
{% if farmers is not null %}
    <table id="farmerTable">
        {% for farmer in farmers %}
            {% if farmer.firstname is defined %}
                {% for farmerProduct in farmer.farmerProducts %}
                    {% if farmerProduct.product is not null %}
                        {% if farmerProduct.product.id == product_id or (farmerProduct.product.parentProduct is not null and farmerProduct.product.parentProduct.id == product_id) %}
                            {% if farmerProduct.unitQuantity >= farmerProduct.unitMinimum  %}
                                <tr class="{{ farmerProduct.id }}">
                                    <td>
                                        Agriculteur : {{ farmer.firstname }}
                                    </td>
                                    <td>
                                        <img style="width: 150px; height: 150px;" src="{{ asset("OEF/img_admin_product/" ~ farmerProduct.product.imageName) }}" alt="{{ farmerProduct.product.imageName }}">
                                    </td>
                                    <td>
                                        Produit : {{ farmerProduct.product.name }}<br>
                                        Type : {{ farmerProduct.unitType }}<br>
                                        Prix : {{ farmerProduct.unitPrice }}<br>
                                        Quantity : {{ farmerProduct.unitQuantity }}<br>
                                        Minimum pour vente : {{ farmerProduct.unitMinimum }}
                                    </td>
                                </tr>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% else %}
            Aucun agriculteurs ne vend ce produit
        {% endfor %}
    </table><br>
{% endif %}

<script type="text/javascript">
    $(function () {
        jQuery(document).ready(function() {

            $("#product").change(function(){
                refresh();
            });

            $("#companyPostCode").change(function(){
                refresh();
            });

            $("#kilos").change(function(){
                refresh();
            });

            $("#unitee").change(function(){
                refresh();
            });

            function refresh(){
                $.ajax({
                    url: '{{ path('oui_eat_french_public_product_ajax_farmer') }}',
                    type: 'POST',
                    data:
                    {
                        product : $('#product').val(),
                        companyPostCode : $('#companyPostCode').val(),
                        parameters : [
                            [
                                ["kilo", $('#kilos').val()],
                                ["unitee", $('#unitee').val()]
                            ]
                        ]
                    },
                    dataType: 'json',
                    success: function(response)
                    {
                        $('#farmerTable tr').each(function()
                        {
                            var id = $(this).attr('class');
                            console.log(response.indexOf(parseInt(id)));
                            if(response.indexOf(parseInt(id)) > -1)
                            {$(this).show();}
                            else
                            {$(this).hide();}
                        });
                    }
                });
                return false;
            };
        });
    });
</script>
